<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<title>Ø¨Ø§Ø²ÛŒ Ù¾Ø±ØªØ§Ø¨ Ø¢ØªØ´ÛŒÙ† </title>
<style>
body { margin:0; overflow:hidden; background:#222; touch-action:none; font-family:Arial,sans-serif; color:white;}
#score,#turns,#nameDisplay,#totalScoreDisplay {position:absolute; font-size:12px; z-index:10;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;pointer-events: none;}
#score {left:50%; bottom:200px; transform:translateX(-50%); text-align:center;}
#turns {left:10px; top:2%; color: #00FF00 ; text-shadow:0 1px 2px black;}
#nameDisplay {top:4%; left:10px; color: #00FF00; text-shadow:0 1px 2px black;}
#totalScoreDisplay {top:6.3%; left:10px; color: #00FF00; text-shadow:0 1px 2px black;}

#livesContainer {
  position: absolute;
  bottom: 10px;
  left: 10px;
  font-size: 14px;
  display: flex;
  gap: 2px;
  user-select: none;
}

.heart {
  transition: transform 0.3s ease, filter 0.3s ease;
}

.heart.lost {
  color: #333;
  transform: scale(0.8);
  filter: grayscale(100%);
}



#finalScore {
  
    position: absolute;
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 35px;
    display: none;
    color: yellow;
    text-align: center;
    line-height: 1.2;
}

#ballLabel {
  position: absolute;
  color: yellow;
  font-size: 9px;
  //font-weight: bold;
  pointer-events: none;
  transform: translate(-120%, -50%);
  display: none; /* Ù¾Ù†Ù‡Ø§Ù† Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ */
}

#gameCanvas {
    display: block;
    margin: 0 auto;
    transform: translateY(10px); /* Ù…Ù‚Ø¯Ø§Ø± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ† */
}

#resetBtnSmall:hover {
  box-shadow: 0 0 2px #0040FF, 0 0 5px #3399FF;
    transform: translateY(-50%) rotate(180deg) scale(1.1);
}

#resetBtn {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 15px 0;
    font-size: 20px;
    display: none;
    cursor: pointer;
    text-align: center;
    background-color: #f39c12;
    color: white;
    z-index:20000;   /* Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù‡Ù…Ù‡ */
    border: none;
}



    
#showScoresBtn {
    position: absolute;
    top: 70px;
    left: 10px;
    width: 130px;
    padding: 8px 0;
    font-size: 13px;          /* ÙÙˆÙ†Øª Ú©ÙˆÚ†Ú© */
    font-weight: 300;          /* Ù†Ø§Ø²Ú© */
    font-family: Arial, sans-serif; /* ÙÙˆÙ†Øª Ø³Ø§Ø¯Ù‡ */
    cursor: pointer;
    background-color: #FFD700;   /* Ø·Ù„Ø§ÛŒÛŒ */
    color: black;                /* Ù…ØªÙ† Ù…Ø´Ú©ÛŒ */
    border: none;
    border-radius: 10px;
    z-index: 10;

    /* Ø¯Ø±Ø®Ø´Ø´ Ø§ÙˆÙ„ÛŒÙ‡ */
    box-shadow: 0 0 2px #FFD700, 0 0 4px #FFA500, 0 0 10px #FFD700;

    transition: all 0.3s ease;

  
    /* Ø§ÛŒØ¬Ø§Ø¯ Ø²Ù…ÛŒÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¹Ú©Ø§Ø³ */
    overflow: visible;
}

/* Ø§Ù†Ø¹Ú©Ø§Ø³ Ø²ÛŒØ± Ø¯Ú©Ù…Ù‡ */
#showScoresBtn::after {
    content: '';
    position: absolute;
    top: 100%;          /* Ø²ÛŒØ± Ø¯Ú©Ù…Ù‡ */
    left: 0;
    width: 100%;
    height: 20px;       /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ù†Ø¹Ú©Ø§Ø³ */
    background: linear-gradient(to top, rgba(255,215,0,0.5), rgba(255,215,0,0)); /* Ù…Ø­Ùˆ */
    border-radius: 10px;
    transform: scaleY(-1);
    filter: blur(4px);
    z-index: -1;
}

/* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¯Ø±Ø®Ø´Ø´ */
@keyframes glowSun {
    0% {
        box-shadow: 0 0 2px #FFD700, 0 0 4px #FFA500, 0 0 10px #FFD700;
    }
    50% {
        box-shadow: 0 0 8px #FFD700, 0 0 15px #FFA500, 0 0 20px #FFD700;
    }
    100% {
        box-shadow: 0 0 2px #FFD700, 0 0 7px #FFA500, 0 0 15px #FFD700;
    }
}

/* Ø§ÙÚ©Øª Ù‡Ø§ÙˆØ± Ø¨Ø§ Ù„Ø±Ø²Ø´ Ùˆ Ø¯Ø±Ø®Ø´Ø´ */
#showScoresBtn:hover {
    background-color: #FFC700;  /* Ø·Ù„Ø§ÛŒÛŒ Ø±ÙˆØ´Ù†â€ŒØªØ± */
    color: black;
}

/* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù„Ø±Ø²Ø´ */
@keyframes shake {
  0% { transform: translateX(0); }
  10% { transform: translateX(-3px); }
  20% { transform: translateX(3px); }
  30% { transform: translateX(-3px); }
  40% { transform: translateX(3px); }
  50% { transform: translateX(-2px); }
  60% { transform: translateX(2px); }
  70% { transform: translateX(-1px); }
  80% { transform: translateX(1px); }
  90% { transform: translateX(0.5px); }
  100% { transform: translateX(0); }
}



#creatorName {
    position: absolute;
    bottom: 10px;          /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ */
    right: 10px;           /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø±Ø§Ø³Øª ØµÙØ­Ù‡ */
    font-size: 10px;       /* Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙˆÙ†Øª Ù…Ù†Ø§Ø³Ø¨ */
    color: rgba(255,255,255,0.5); /* Ø´ÙØ§ÙÛŒØª Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ø¨Ø§ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
    font-style: italic;    /* ÙÙˆÙ†Øª Ø§ÛŒØªØ§Ù„ÛŒÚ© */
    pointer-events: none;  /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù…ØªÙ† */
    z-index: 10;           /* Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ú©Ø§Ù†ÙˆØ§Ø³ Ùˆ Ø¹Ù†Ø§ØµØ± Ø¯ÛŒÚ¯Ø± */
    text-shadow: 0 1px 2px rgba(0,0,0,0.5); /* Ú©Ù…ÛŒ Ø³Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø²ÛŒØ¨Ø§ÛŒÛŒ */
    font-family: Arial, sans-serif;
}



#chatBox {
    position: absolute; /* Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² z-index Ø¨Ø§ÛŒØ¯ position ØªØ¹Ø±ÛŒÙ Ø´ÙˆØ¯ */
    position: fixed;
    bottom: 50px;
    right: 20px;
    width: 350px;
    height: 650px;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 10px;
    border-radius: 10px;
    overflow-y: auto;
z-index: 9999; /* ØªØ¹ÛŒÛŒÙ† Ù„Ø§ÛŒÙ‡ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø³Ø§ÛŒØ± Ø¹Ù†Ø§ØµØ± */
}

  #chatInput {
    position: fixed;
    bottom: 75px;   /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ */
    left: 10px;     /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø³Ù…Øª Ú†Ù¾ ØµÙØ­Ù‡ */
    right: 10px;    /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø³Ù…Øª Ø±Ø§Ø³Øª ØµÙØ­Ù‡ */
    z-index: 10;    /* Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø³Ø§ÛŒØ± Ù…Ø­ØªÙˆØ§ Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ø¯ */
    background-color: white;
    padding: 10px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù† Ø¬Ù„ÙˆÙ‡ Ø³Ø§ÛŒÙ‡ */
text-align: right;  /* Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø±Ø§Ø³Øªâ€ŒÚ†ÛŒÙ† Ø¨ÙˆØ¯Ù† Ù…ØªÙ† ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ */
}
 #chatSend {
    position: fixed;
    bottom: 20px;   /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ */
    left: 10px;     /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø³Ù…Øª Ú†Ù¾ ØµÙØ­Ù‡ */
    right: 10px;    /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø³Ù…Øª Ø±Ø§Ø³Øª ØµÙØ­Ù‡ */
    z-index: 10;    /* Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ø³Ø§ÛŒØ± Ù…Ø­ØªÙˆØ§ Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ø¯ */
    background-color: green;
    padding: 10px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù† Ø¬Ù„ÙˆÙ‡ Ø³Ø§ÛŒÙ‡ */
}
#chatMessages {
    padding-bottom: 60px; /* ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ùˆ ÙÛŒÙ„Ø¯ ØªØ§ÛŒÙ¾ */
    overflow-y: scroll;   /* Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ */
text-align: right; /* Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¨Ù‡ Ø³Ù…Øª Ø±Ø§Ø³Øª ØªØ±Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ */
}


#toggleChatBtn {
     position: fixed;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 5%;          /* Ø¹Ø±Ø¶ Ú©ÙˆÚ†Ú© */
    height: 30%;
    background-color: #ff4500;
    color: white;
    font-weight: normal;
    font-size: 12px;
    text-align: center;
    line-height: 14px;
    border-radius: 25px 0 0 25px;
    cursor: pointer;
    box-shadow: 0 0 2px #ff4500, 0 0 5px #ff6347;
    transition: all 0.3s ease;
    writing-mode: vertical-rl; /* Ù…ØªÙ† Ø¹Ù…ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ø§ Ø´Ø¯Ù† Ø¯Ø± Ø¹Ø±Ø¶ Ú©Ù… */
    z-index: 20000;
}

#toggleChatBtn:hover {
     box-shadow: 0 0 2px #ff4500, 0 0 5px #ff6347;
    transform: translateY(-50%) scale(1.1);
}


    

canvas {
    display: block;
    width: 100%;   /* Ø¹Ø±Ø¶ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ ÙˆÙ„ÛŒ Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ canvas Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± */
    height: 100%;  /* Ø§Ø±ØªÙØ§Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ */
}

</style>
</head>
<body>



<!-- ===== Tutorial Modal (place this just after <body> or before your canvas) ===== -->
<style>
/* tutorial modal styles */
#tutorialModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9997;
  -webkit-backdrop-filter: blur(4px);
  backdrop-filter: blur(4px);
}
#tutorialCard {
  width: min(720px, 92vw);
  background: linear-gradient(180deg,#1f1f2a,#2b2b35);
  border-radius: 12px;
  padding: 18px;
  color: #fff;
  box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  text-align: center;
}
.tut-step { display: none; }
.tut-step.active { display: block; }

/* simple demo area (ball + finger animation) */
.tut-demo {
  margin: 12px auto;
  width: 240px;
  height: 160px;
  position: relative;
  background: linear-gradient(180deg,#222,#1b1b1b);
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.04);
}
.tut-ball {
  position: absolute;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, #fff, #ddd 35%, #999 100%);
  box-shadow: 0 4px 8px rgba(0,0,0,.6), 0 0 8px rgba(255,255,255,0.03) inset;
}
.tut-finger {
  position: absolute;
  width: 32px;
  height: 32px;
  border-radius: 50%;  /* ğŸ‘ˆ Ø­Ø§Ù„Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø§ÛŒØ±Ù‡ */
  background: rgba(255,255,255,0.9);
  transform-origin: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.5);
  opacity: .95;
}


/* animation for step 1: drag up */
@keyframes finger-drag {
  0% { left: 50%; bottom: 36px; transform: translate(-50%,0) scale(1); opacity:.95; }
  50% { left: 30%; bottom: 80px; transform: translate(-50%,-4px) scale(.95); }
  100% { left: 18%; bottom: 120px; transform: translate(-50%,-8px) scale(.9); opacity:.0; }
}
/* animation for step 2: release (finger tap and ball flies) */
@keyframes finger-tap {
  0% { left: 50%; bottom: 36px; transform: translate(-50%,0) scale(1); }
  40% { transform: translate(-50%,-6px) scale(.95); }
  100% { transform: translate(-50%,0) scale(1); opacity: .0; }
}
@keyframes ball-fly {
  0% { transform: translateX(-50%) translateY(0) scale(1); opacity:1; }
  100% { transform: translateX(-50%) translateY(-220px) scale(.6); opacity:0; }
}

/* controls */
.tut-controls { margin-top:8px; display:flex; gap:8px; justify-content:center; align-items:center; }
.tut-controls button {
  padding:8px 12px; border-radius:8px; border:0; cursor:pointer;
  background:#f39c12; color:#111; font-weight:600;
}
.tut-controls .secondary { background:#444; color:white; }

/* checkbox line */
.tut-bottom { margin-top:8px; font-size:13px; color:#ddd; display:flex; gap:10px; align-items:center; justify-content:center; }
.tut-bottom input[type="checkbox"]{ transform:scale(1.1); margin-right:6px; }
</style>

<div id="tutorialModal" aria-hidden="true" style="display:none;">
  <div id="tutorialCard" role="dialog" aria-modal="true" aria-label="Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ">
    <!-- step 1 -->
    <div class="tut-step" id="tut-step-1">
      <h3>Ù†Ø­ÙˆÙ‡ Ù¾Ø±ØªØ§Ø¨</h3>
      <p style="margin:6px 0 10px;"> ØªÙˆÙ¾ Ø±Ø§ Ø¨Ù‡ Ø³Ù…Øª Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ ØµÙØ­Ù‡ Ù‡ÙÙ„ Ø¨Ø¯Ù‡</p>
      <div class="tut-demo" aria-hidden="true">
        <div class="tut-ball" id="demoBall1"></div>
        <div class="tut-finger" id="demoFinger1" style="left:50%; bottom:36px; animation: finger-drag 1500ms linear infinite;"></div>
      </div>
      <div class="tut-controls">
        <button id="tut-next-1">Ø¨Ø¹Ø¯ÛŒ â€º</button>
        <button class="secondary" id="tut-skip">Ù¾Ø±Ø´</button>
      </div>
    </div>

    <!-- step 2 -->
    <div class="tut-step" id="tut-step-2">
      <h3>Ø±ÙˆØ´ Ø§Ù…ØªÛŒØ§Ø² Ú¯ÛŒØ±ÛŒ</h3>
      <p style="margin:6px 0 10px;">Ø³Ø¹ÛŒ Ú©Ù† ØªÙˆÙ¾ Ø±Ø§ Ø·ÙˆØ±ÛŒ Ù‡Ù„ Ø¨Ø¯ÛŒ Ú©Ù‡ Ø¯Ø± Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ØªØ± Ù…ØªÙˆÙ‚Ù Ø´ÙˆØ¯</p>
      <div class="tut-demo" aria-hidden="true">
        <div class="tut-ball" id="demoBall2" style="left:50%; bottom:36px;"></div>
        <div class="tut-finger" id="demoFinger2" style="left:50%; bottom:36px;"></div>
      </div>
      <div class="tut-controls">
        <button id="tut-back-2" class="secondary">â€¹ Ù‚Ø¨Ù„ÛŒ</button>
        <button id="tut-start">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
      </div>
    </div>

    <div class="tut-bottom">
      <label><input type="checkbox" id="dontShowAgain"> Ù†Ù…Ø§ÛŒØ´ Ù†Ø¯Ù‡ Ø¯ÙˆØ¨Ø§Ø±Ù‡</label>
    </div>
  </div>
</div>

<script>
(function(){
  const modal = document.getElementById('tutorialModal');
  const step1 = document.getElementById('tut-step-1');
  const step2 = document.getElementById('tut-step-2');
  const next1 = document.getElementById('tut-next-1');
  const skip = document.getElementById('tut-skip');
  const back2 = document.getElementById('tut-back-2');
  const startBtn = document.getElementById('tut-start');
  const chk = document.getElementById('dontShowAgain');

  // demo animations for step2: run finger tap and ball fly repeatedly
  const finger2 = document.getElementById('demoFinger2');
  const ball2 = document.getElementById('demoBall2');
  function startStep2Anim(){
    // finger tap
    finger2.style.opacity = '1';
    finger2.style.animation = 'finger-tap 900ms ease-in-out forwards';
    // ball fly (after short delay)
    ball2.style.animation = 'ball-fly 900ms ease-in forwards';
    // loop with interval
    clearInterval(window._tut2Interval);
    window._tut2Interval = setInterval(()=> {
      finger2.style.animation = 'none';
      ball2.style.animation = 'none';
      // force reflow
      void finger2.offsetWidth;
      void ball2.offsetWidth;
      finger2.style.animation = 'finger-tap 900ms ease-in-out forwards';
      ball2.style.animation = 'ball-fly 900ms ease-in forwards';
    }, 1400);
  }
  function stopStep2Anim(){
    clearInterval(window._tut2Interval);
    finger2.style.animation = 'none';
    ball2.style.animation = 'none';
  }

  // check localStorage â€” Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø¯ÛŒØ¯Ù‡ Ø´Ø¯ØŒ ÙˆØµÙ„ Ù†Ø´ÙˆØ¯
  try {
    const seen = localStorage.getItem('darts_tutorial_shown_v1');
    if (seen === 'yes') {
      // do nothing â€” keep modal hidden
      return;
    }
  } catch(e){ /* ignore storage errors */ }

  // show modal
  function openTutorial(){
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');
    showStep(1);
    // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ú©Ø§Ù†ÙˆØ§Ø³ (Ø¯Ø±ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ú©Ø§Ù†ÙˆØ§Ø³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡)
    const cv = document.getElementById('gameCanvas');
    if(cv) cv.style.pointerEvents = 'none';
  }

  function closeTutorial(){
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');
    stopStep2Anim();
    const cv = document.getElementById('gameCanvas');
    if(cv) cv.style.pointerEvents = '';
    if(chk.checked){
      try { localStorage.setItem('darts_tutorial_shown_v1','yes'); } catch(e){}
    }
  }

  function showStep(n){
    step1.classList.remove('active');
    step2.classList.remove('active');
    if(n===1){ step1.classList.add('active'); stopStep2Anim(); }
    if(n===2){ step2.classList.add('active'); startStep2Anim(); }
  }

  next1.addEventListener('click', ()=> showStep(2));
  back2.addEventListener('click', ()=> showStep(1));
  skip.addEventListener('click', ()=> { closeTutorial(); });
  startBtn.addEventListener('click', ()=> { closeTutorial(); });

  // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¢Ù…ÙˆØ²Ø´ Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ (Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø´Ø±Ø·Ù Ø¯ÛŒÚ¯Ø±ÛŒ Ù‡Ù… Ø¨Ø°Ø§Ø±ÛŒ)
  // Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø®Ø§Øµ Ø¨Ø§Ø² Ø´ÙˆØ¯ØŒ ØºÛŒØ±ÙØ¹Ø§Ù„Ø´ Ú©Ù† Ùˆ ÙÙ‚Ø· ØªØ§Ø¨Ø¹ openTutorial Ø±Ø§ Ø§Ø² Ø¢Ù† Ø¯Ú©Ù…Ù‡ ØµØ¯Ø§ Ø¨Ø²Ù†
  openTutorial();

})();
</script>
<!-- ===== tutorial modal end ===== -->



<!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ Ú†Øª -->
<button id="toggleChatBtn">Show Chat Room</button>

<!-- ØµÙØ­Ù‡ Ú†Øª -->
<div id="chatBox" style="display: none;">
    <div id="chatMessages"></div>
    <input type="text" id="chatInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
    <button id="chatSend">Ø§Ø±Ø³Ø§Ù„</button>
</div>




<div id="nameDisplay"></div>
<div id="totalScoreDisplay"></div>

<div id="livesContainer">
  <span id="life1" class="heart">â¤ï¸</span>
  <span id="life2" class="heart">â¤ï¸</span>
  <span id="life3" class="heart">â¤ï¸</span>
</div>


<div id="turns"></div>
<div id="bestPlayer" style="position:absolute; left:10px; top:70px; font-size:10px; color:#FF00FF;"></div>
<div id="score"></div>
<div id="finalScore"></div>
<span id="ballLabel">0</span>

  <audio id="gameSound" preload="auto">
    <source src="https://raw.githubusercontent.com/mohsenforghani/gamesound/refs/heads/main/SoundGamePartaab.mp3" type="audio/mp3">
    Your browser does not support the audio element.
</audio>
<audio id="over100" preload="auto">
    <source src="https://raw.githubusercontent.com/mohsenforghani/gamesound/refs/heads/main/over100.mp3" type="audio/mp3">
    Your browser does not support the audio element.
</audio>

  <audio id="scoresound" preload="auto">
    <source src="https://raw.githubusercontent.com/mohsenforghani/gamesound/refs/heads/main/jiring.mp3" type="audio/mp3">
    Your browser does not support the audio element.
</audio>

<div id="topPlayerName" style="
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 22px;
    font-weight: bold;
    text-align: center;
    line-height: 1.4;
    z-index: 0;       /* Ù¾Ø´Øª canvas */
    opacity: 0.6;     /* Ø´ÙØ§ÙÛŒØª Ø«Ø§Ø¨Øª */
">
    <div id="topPlayerLabel" class="glowText">Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†</div>
    <div id="topPlayerNameValue" class="glowText">ğŸ† ... ğŸ†</div>
</div>

<style>
.glowText {
    color: gold;
    font-size: 22px;
    font-weight: bold;
    text-shadow:
        0 0 5px rgba(255,255,255,0.6),
        0 0 10px rgba(255,215,0,0.6),
        0 0 15px rgba(255,165,0,0.6),
        0 0 20px rgba(255,140,0,0.6);
  
}
</style>






<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>





<!-- Ù‡Ø´Ø¯Ø§Ø± Ø§ÛŒÙ†ØªØ±Ù†Øª -->
<div id="internetWarning" style="
    display:none;
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background: linear-gradient(180deg, #ff4c4c, #ff7676);
    color:white;
    padding:25px 35px;
    border-radius:20px;
    text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,1);
    z-index:9996;
    font-family: Arial, sans-serif;
">
    <img src="data:image/png;base64,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" 
         style="width:60px; height:60px; display:block; margin:0 auto 15px;">
    <h3 style="margin:0 0 10px;">Ø§ÛŒÙ†ØªØ±Ù†Øª ÙˆØµÙ„ Ù†ÛŒØ³Øª</h3>
    <p style="margin:0 0 20px;">Ø§Ú¯Ù‡ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø§Ù…ØªÛŒØ§Ø²Øª Ø«Ø¨Øª Ø¨Ø´Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø§ÛŒÙ†ØªØ±Ù†Øª ÙˆØµÙ„ Ø¨Ø´ÛŒ</p>
    <button id="internetOkBtn" style="
        padding:10px 20px;
        font-size:14px;
        font-weight:bold;
        color:#ff4c4c;
        background:white;
        border:none;
        border-radius:8px;
        cursor:pointer;
        transition:0.3s;
    " onmouseover="this.style.background='#f0f0f0';" onmouseout="this.style.background='white';">
        Ø¨Ø§Ø´Ù‡
    </button>
</div>







<div id="totalScoreDisplay" style="
    position:absolute;
    bottom:2%;        /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† */
    left:2%;          /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ú†Ù¾ */
    color: yellow;  /* Ø´ÙØ§ÙÛŒØª Ù…Ø´Ø§Ø¨Ù‡ */
    font-size:16px;     /* Ù‡Ù…Ø§Ù† Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙˆÙ†Øª */
    font-style:italic;  /* Ù…Ø«Ù„ ÙÙˆÙ†Øª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ */
    text-shadow:0 1px 2px rgba(0,0,0,0.5); /* Ø³Ø§ÛŒÙ‡ Ù…Ø´Ø§Ø¨Ù‡ */
    font-family: Arial, sans-serif;
    pointer-events:none; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ù„ÛŒÚ© */
    z-index:10;
"></div>


<button id="downloadBtn" style="
    position: fixed;
    top: 50%;
    left: 0;
    width: 100%;
    padding: 20px 0;
    font-size: 30px;
    font-weight: bold;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 0;
    cursor: pointer;
    z-index: 10000;
    display: none;  /* Ø§Ø¨ØªØ¯Ø§ Ù…Ø®ÙÛŒ Ø¨Ø§Ø´Ø¯ */
">Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„(Zip)</button>






<button id="showScoresBtn">Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</button>
<canvas id="gameCanvas"></canvas>


    


 //  <div id="newsTicker" style="
 //   position: absolute;
 //   bottom: 62px; 
 //   left: -20%; /* Ø´Ø±ÙˆØ¹ Ø§Ø² Ø®Ø§Ø±Ø¬ ØµÙØ­Ù‡ */
  //  white-space: nowrap;
  //  font-size: 12px; 
 //   color: yellow; 
 //   font-family: Arial, sans-serif;
// -webkit-user-select: none; /* Ø¨Ø±Ø§ÛŒ Safari Ùˆ iOS */
//  -moz-user-select: none;    /* Ø¨Ø±Ø§ÛŒ Firefox */
//  -ms-user-select: none;     /* Ø¨Ø±Ø§ÛŒ IE */
//  user-select: none;         /* Ø¨Ø±Ø§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ */
//  pointer-events: none;      /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ£Ø«ÛŒØ± Ú©Ù„ÛŒÚ© ÛŒØ§ Ø¯Ø±Ú¯ Ø±ÙˆÛŒ Ø³Ø§ÛŒØ± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
//    z-index: 1000;
// "></div>



<button id="resetBtn">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>

<!-- Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ø¦Ù…ÛŒ Ú©ÙˆÚ†Ú© -->
<button id="resetBtnSmall" style="
    position: fixed;
    left: 0;
    top: 50%;
    transform: translateY(-50%) rotate(180deg);
    width: 5%;
    height: 30%;
    background-color: #0040FF;
    color: white;
    font-size: 12px;
    text-align: center;
    line-height: 14px;
    border-radius: 20px  0 0 20px ; 
    cursor: pointer;
    box-shadow: 0 0 2px #0040FF, 0 0 5px #3399FF;
    transition: all 0.3s ease;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    z-index: 20000;
">Reset Game</button>






<!-- Ù†Ø§Ù… Ø³Ø§Ø²Ù†Ø¯Ù‡ -->
<div id="creatorName">Created by Mohsen Forghani</div>




<script>
const canvas = document.getElementById('gameCanvas');
const ballLabel = document.getElementById("ballLabel");



const ctx = canvas.getContext('2d');

let playerName = prompt("Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
if(!playerName) playerName = "Ù†Ø§Ø´Ù†Ø§Ø³";
localStorage.setItem('playerName', playerName);
// let currentNews = "";
let totalScore = 0;
let turn = 0;
const maxTurns = 5;
let turnScores = [];
let lives = 3;
  
  let gameSound = document.getElementById('gameSound');
let soundOver100 = document.getElementById('over100');
  let soundscoreingame = document.getElementById('scoresound');
// ÙˆÙ‚ØªÛŒ Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ ØµØ¯Ø§ Ø±Ø§ Ù¾Ø®Ø´ Ú©Ù†
function startGame() {
    gameSound.loop = true;  // Ø¨Ø±Ø§ÛŒ ØªÚ©Ø±Ø§Ø± ØµØ¯Ø§
    gameSound.play();       // Ù¾Ø®Ø´ ØµØ¯Ø§
}

function soundradshodan100() {
    soundOver100.play();       // Ù¾Ø®Ø´ ØµØ¯Ø§
  soundOver100.loop = false;  // Ø¨Ø±Ø§ÛŒ ØªÚ©Ø±Ø§Ø± ØµØ¯Ø§   
}
  function soundscorefunc() {
    soundscoreingame.play();       // Ù¾Ø®Ø´ ØµØ¯Ø§
  soundscoreingame.loop = false;  // Ø¨Ø±Ø§ÛŒ ØªÚ©Ø±Ø§Ø± ØµØ¯Ø§   
}
  
let resizeTapCount = 0;  // Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¶Ø±Ø¨Ù‡ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Ø§ÛŒØ²
const tapsNeeded = 20;    // ØªØ¹Ø¯Ø§Ø¯ Ø¶Ø±Ø¨Ù‡ Ù„Ø§Ø²Ù… Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Ø§ÛŒØ²
  
let ball = {x:0, y:0, r:20, vx:0, vy:0, color:'white', scored:false};
let hasThrown = false;
let isMoving = false;
const friction = 0.98;

let startTouch = null;

// Canvas
function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    document.body.style.height = window.innerHeight + "px";  // Ù‡Ù…ÙˆÙ† Ú©Ø§Ø±ÛŒ Ú©Ù‡ setFullHeight Ù…ÛŒâ€ŒÚ©Ø±Ø¯
    ball.x = canvas.width/2;
    ball.y = canvas.height * 0.93;
}

resizeCanvas();
window.addEventListener('resize', resizeCanvas);




// Scale
function drawScoreScale(){
    ctx.save();
    ctx.font = "bold 20px 'Times New Roman'";
    ctx.textAlign = "left";
    ctx.textBaseline = "top";

    for(let s=1; s<=100; s++){
        let y = canvas.height - (s/100)*canvas.height;

        if(s % 10 === 0){  
            // Ø®Ø·ÙˆØ· Ø§ØµÙ„ÛŒ: Ø¢Ø¨ÛŒ Ùˆ Ø®Ø·â€ŒÚ†ÛŒÙ†
            ctx.strokeStyle = 'rgba(121,234,195,0.6)'; // Ø¢Ø¨ÛŒ Ù†ÛŒÙ…Ù‡â€ŒØ´ÙØ§Ù
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 8]); 
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
            ctx.stroke();
            ctx.setLineDash([]); 

            // Ù†ÙˆØ´ØªÙ† Ø¹Ø¯Ø¯ Ø²Ø±Ø¯
            ctx.fillStyle = 'yellow';
            ctx.fillText(s, canvas.width - 60, y);

            // === Ø®Ø·â€ŒÚ†ÛŒÙ† Ù‚Ø±Ù…Ø² Ø¨Ø±Ø§ÛŒ 100 ===
            if(s === 100){
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 4;
                ctx.setLineDash([10, 8]); // Ø§Ù„Ú¯ÙˆÛŒ Ø®Ø·â€ŒÚ†ÛŒÙ†
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
                ctx.setLineDash([]); // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
            }

        } else {
            // Ø®Ø·ÙˆØ· ÙØ±Ø¹ÛŒ: Ø¨Ù†ÙØ´ Ø³Ø§Ø¯Ù‡
            ctx.strokeStyle = 'rgba(255,255,255,0.2)'; // Ø³ÙÛŒØ¯
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
            ctx.stroke();
        }
    }
    ctx.restore();
}





// Touch events
function getTouchPos(e) {
    const rect = canvas.getBoundingClientRect();
    let x, y;
    if(e.touches) {  // Ù…ÙˆØ¨Ø§ÛŒÙ„
        x = e.touches[0].clientX;
        y = e.touches[0].clientY;
    } else {         // Ù…Ø§ÙˆØ³
        x = e.clientX;
        y = e.clientY;
    }
    return {
        x: (x - rect.left) * (canvas.width / rect.width),
        y: (y - rect.top) * (canvas.height / rect.height)
    };
}








canvas.addEventListener('pointerdown', e=>{
    e.preventDefault();
if (e.pointerType !== 'touch' ) return;

  // ===== Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¶Ø±Ø¨Ù‡ Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Ø§ÛŒØ² =====
    resizeTapCount++;
    if(resizeTapCount >= tapsNeeded){
        resizeCanvas();       // ÙÙ‚Ø· Ø±ÛŒØ³Ø§ÛŒØ² Ú©Ø§Ù†ÙˆØ§Ø³
        resizeTapCount = 0;   // Ø±ÛŒØ³Øª Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡
    }
  
    if(hasThrown || isMoving || turn >= maxTurns) return;
    const pos = getTouchPos(e);
    const dx = pos.x - ball.x;
    const dy = pos.y - ball.y;
    if(Math.sqrt(dx*dx + dy*dy) < ball.r){
        startTouch = pos;
    }
},{passive:false});

canvas.addEventListener('pointerup', e=>{
    if(!startTouch) return;
    if(turn >= maxTurns) return;
    const endPos = getTouchPos(e);
    const dx = endPos.x - startTouch.x;
    const dy = endPos.y - startTouch.y;
    ball.vx = dx*0.2;
    ball.vy = dy*0.2;
    isMoving = true;
    hasThrown = true;
    startTouch = null;
});



// Ø¯Ú©Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ú†Øª
document.getElementById('toggleChatBtn').addEventListener('click', () => {
    const chatBox = document.getElementById('chatBox');
    const chatBtn = document.getElementById('toggleChatBtn');

    if (chatBox.style.display === 'none') {
        // Ù†Ù…Ø§ÛŒØ´ Ú†Øª
        chatBox.style.display = 'block';
        chatBtn.innerText = 'Hide Chat Room';
    } else {
        // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ú†Øª
        chatBox.style.display = 'none';
        chatBtn.innerText = 'Show Chat Room'; // ØªØºÛŒÛŒØ± Ù…ØªÙ† Ø¯Ú©Ù…Ù‡
    }
});


  



  

document.getElementById("showScoresBtn").addEventListener("click", ()=>{
    const btn = document.getElementById("showScoresBtn");
  
    void btn.offsetWidth; // force reflow
    

    // ==== Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ù†Ø¬Ø±Ù‡ Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ù„Ø§Ú© Ø´Ø¯Ù† popup ====
    let win = window.open("", "_blank", "width=600,height=800");

    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… loading Ø§ÙˆÙ„ÛŒÙ‡
    win.document.write(`
<div style="
    width: 100vw; 
    height: 100vh; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    font-size: 32px; 
    font-weight: normal;
    text-align: center;
">
Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ù†ÙØ±Ø§Øª Ø§ÙˆÙ„ ØªØ§ 250...
</div>
`);
  

    fetch("https://script.google.com/macros/s/AKfycbzDT1ifMtyL7TJlHgG916tiOhfdPpgQ8iZd-t41OjO7JoY9YXv0oCHJpAVFZaETpF4l1A/exec")
    .then(res=>res.json())
    .then(data=>{
        data.sort((a,b)=> b.score - a.score);

        // Ø±ØªØ¨Ù‡ 1 ØªØ§ 250
        data = data.slice(0, 250);

        let html = `
        <html lang="fa">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
            <title> Ù„ÛŒØ³Øª Ø§Ù…ØªÛŒØ§Ø²Ø§Øª </title>
            <style>
                body { font-family: Arial, sans-serif; margin: 10px; }
                table { border-collapse: collapse; width: 100%; }
                th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
                th { background: #eee; }
                .first { color: red; font-size: 24px; font-weight: bold; }
                .others { color: black; font-size: 16px; font-weight: normal; }
            </style>
        </head>
        <body>
            <h2 style="text-align:center;">ğŸ† Ù„ÛŒØ³Øª Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</h2>
            <table>
                <tr>
                    <th>Ø±Ø¯ÛŒÙ</th>
                    <th>Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†</th>
                    <th>Ø§Ù…ØªÛŒØ§Ø²</th>
                </tr>`;

        data.forEach((row, index)=>{
            if(index === 0){
                html += `<tr class="first">
                    <td>${index+1}</td>
                    <td>${row.name}</td>
                    <td>${row.score}</td>
                </tr>`;
            } else {
                html += `<tr class="others">
                    <td>${index+1}</td>
                    <td>${row.name}</td>
                    <td>${row.score}</td>
                </tr>`;
            }
        });

        html += `</table></body></html>`;

        // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ù¾Ù†Ø¬Ø±Ù‡ Ø¨Ø§Ø² Ø´Ø¯Ù‡ Ø¨Ø§ Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù‚Ø¹ÛŒ
        win.document.open();
        win.document.write(html);
        win.document.close();
    })
    .catch(err=>{
        win.document.body.innerHTML = "<h2 style='text-align:center;color:red;'>Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h2>";
        console.error(err);
    });
});


// Update
function update(){
    if(isMoving){
        ball.vx *= friction;
        ball.vy *= friction;
        ball.x += ball.vx;
        ball.y += ball.vy;
        if(ball.y > canvas.height - ball.r){
            ball.y = canvas.height - ball.r;
            ball.vy = 0;

        }
        if(Math.abs(ball.vx) < 0.1 && Math.abs(ball.vy) < 0.1){
            ball.vx = 0;
            ball.vy = 0;
            isMoving = false;
        }
    }

    if(hasThrown && !isMoving && !ball.scored){
        calculateScore();
       
    }
 updateFloats();
}




function calculateScore() {
    if (turn >= maxTurns) return;

    let score;
    if (ball.y < 0 && lives >= 0) {
        score = 0;
        lives--;
 
// ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ù‚Ù„Ø¨â€ŒÙ‡Ø§
        if (lives === 2) document.getElementById('life3').innerText = 'ğŸ–¤';
        if (lives === 1) document.getElementById('life2').innerText = 'ğŸ–¤';
        if (lives === 0) {
            document.getElementById('life1').innerText = 'ğŸ–¤';
         setTimeout(() => {   
         alert('ğŸ’€ Game Over!');
         showFinalScore();
         sendScore();
               }, 1500);
}
    } else {
        score = (canvas.height - ball.y) / canvas.height * 100;
        score = parseFloat(score.toFixed(2));
    }

    turnScores.push(score);
    totalScore += score;
    soundscorefunc();

    document.getElementById('totalScoreDisplay').style.display = 'block';
    document.getElementById('totalScoreDisplay').innerText = 'Total Score : ' + totalScore.toFixed(2);

    const displayText = '+' + Number(score).toFixed(2);
    const fx = ball.x;
    const fy = Math.max(ball.y - ball.r - 6, 20);
    spawnFloat(displayText, fx, fy);

    turn++;
    ball.scored = true;
    document.getElementById('turns').innerText = 'Turn : ' + turn + '/' + maxTurns;

    setTimeout(() => {
        resetBall();
        hasThrown = false;
        ball.scored = false;

        if (turn >= maxTurns) {
            

 // === Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù… Ùˆ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ ===
            localStorage.setItem('totalScore', totalScore.toFixed(2));
            // === Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ… Ù¾Ø³ Ø§Ø² Ù¾Ø§ÛŒØ§Ù† Ù†ÙˆØ¨Øªâ€ŒÙ‡Ø§ ===
            setTimeout(() => {
                // Ø¢Ø¯Ø±Ø³ ÙØ§ÛŒÙ„ HTML Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ… Ø¯Ø± GitHub (raw)
                const nextStageURL = "https://mohsenforghani.github.io/partaab2/";

                // Ù‡Ø¯Ø§ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ… Ø¯Ø± Ù‡Ù…Ø§Ù† ØªØ¨
                window.location.href = nextStageURL;
            }, 1500); // Ú©Ù…ÛŒ ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ
        }
    }, 500);
}




// ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡

function resetBall(){
    ball.x = canvas.width/2;
    ball.y = canvas.height * 0.93;
    ball.vx = 0;
    ball.vy = 0;
    ball.color = 'white';
    ball.scored = false;
}

    
//let newsMessages = []; // Ø¢Ø±Ø§ÛŒÙ‡ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø§Ø®Ø¨Ø§Ø±

//async function fetchNews() {
//    try {
  //      const rawUrl = "https://raw.githubusercontent.com/mohsenforghani/news/refs/heads/main/news.txt?t=" + new Date().getTime();
  //      const response = await fetch(rawUrl);
 //       if(!response.ok) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø®Ø¨Ø§Ø±");
  //      const text = await response.text();
  //      newsMessages = text.split("\n").filter(line => line.trim() !== "");
  //  } catch (err) {
  //      console.error("Ø§Ø®Ø¨Ø§Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯:", err);
 //   }
// }

// ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ Ø³Ù¾Ø³ Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
//fetchNews();
//setInterval(fetchNews, 10000);

    
    
//function showNewsTicker(text) {
 //   let ticker = document.getElementById('newsTicker');
  //  if(!ticker){
   //     ticker = document.createElement('div');
   //     ticker.id = 'newsTicker';
   //     ticker.style.position = 'absolute';
   //     ticker.style.bottom = '62px';
   //     ticker.style.whiteSpace = 'nowrap';
    //    ticker.style.fontSize = '12px';
    //    ticker.style.color = 'red';
    //    ticker.style.zIndex = 1000;
     //   document.body.appendChild(ticker);
  //  }
   // ticker.innerText = text;
    
    // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¹Ø¨ÙˆØ± Ø§Ø² Ú†Ù¾ Ø¨Ù‡ Ø±Ø§Ø³Øª
   // ticker.style.transition = 'none';
 //   ticker.style.left = '-' + ticker.offsetWidth + 'px';  // Ø´Ø±ÙˆØ¹ Ø§Ø² Ø¨ÛŒØ±ÙˆÙ† Ø³Ù…Øª Ú†Ù¾
 //   void ticker.offsetWidth; // force reflow
 //   ticker.style.transition = 'left 15s linear';
  //  ticker.style.left = window.innerWidth + "px";  // Ø­Ø±Ú©Øª ØªØ§ Ø¨ÛŒØ±ÙˆÙ† Ø³Ù…Øª Ø±Ø§Ø³Øª

    // ØªÚ©Ø±Ø§Ø± Ø¯ÙˆØ¨Ø§Ø±Ù‡
  //  setTimeout(() => {
 //       ticker.style.transition = 'none';
 //       ticker.style.left = '-' + ticker.offsetWidth + 'px';  // Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø±Ù‡ Ú†Ù¾
   //     void ticker.offsetWidth;
   //     ticker.style.transition = 'left 15s linear';
  //      ticker.style.left = window.innerWidth + "px";  // Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø­Ø±Ú©Øª Ú©Ù†Ù‡ Ø¨Ù‡ Ø±Ø§Ø³Øª
 //   }, 16000);  // Ø²Ù…Ø§Ù† Ø¯Ù‚ÛŒÙ‚ Ø±Ùˆ Ø¨Ø§ÛŒØ¯ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø³Ø±Ø¹Øª (15s) ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒ
// }






// setInterval(async () => {
//    try {
 //       const response = await fetch("https://raw.githubusercontent.com/mohsenforghani/news/refs/heads/main/news.txt?t=" + new Date().getTime());
  //      const latestNews = await response.text();
   //     if(latestNews !== currentNews){
   //         currentNews = latestNews;
    //        showNewsTicker(currentNews);
    //    }
   // } catch(err){
    //    console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª news:", err);
 //   }
// }, 5000); // Ù‡Ø± 5 Ø«Ø§Ù†ÛŒÙ‡ Ú†Ú© Ø´ÙˆØ¯

//setInterval(fetchNews, 5000);


function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawScoreScale();

    // ØªÙˆÙ¾ Ø³ÙÛŒØ¯ Ø¨Ø§ Ø¨Ø±Ø¬Ø³ØªÚ¯ÛŒ Ú©Ø±ÙˆÛŒ
    let gradient = ctx.createRadialGradient(
        ball.x - ball.r*0.3, 
        ball.y - ball.r*0.3, 
        ball.r*0.1, 
        ball.x, 
        ball.y, 
        ball.r
    );
    gradient.addColorStop(0, '#ffffff');   // Ù…Ø±Ú©Ø² Ø±ÙˆØ´Ù†
    gradient.addColorStop(0.7, '#dddddd'); // Ø®Ø§Ú©Ø³ØªØ±ÛŒ Ø±ÙˆØ´Ù† Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¬Ø³ØªÚ¯ÛŒ
    gradient.addColorStop(1, '#aaaaaa');   // Ù„Ø¨Ù‡ ØªÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù‚

    ctx.fillStyle = gradient;

    // Ø³Ø§ÛŒÙ‡ Ø®Ø§Ø±Ø¬ÛŒ
    ctx.shadowColor = 'rgba(0,0,0,0.3)';
    ctx.shadowBlur = 10;
    ctx.shadowOffsetX = 3;
    ctx.shadowOffsetY = 3;

    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
    ctx.fill();

    // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø³Ø§ÛŒÙ‡ Ø¨Ø¹Ø¯ Ø§Ø² Ø±Ø³Ù… ØªÙˆÙ¾
    ctx.shadowColor = 'transparent';

   drawFloats();
    document.getElementById('turns').innerText='Turn : '+turn+'/'+maxTurns;
}





function showFinalScore(){
    document.getElementById('finalScore').innerHTML =
        'Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ<br>' + totalScore.toFixed(2);
    document.getElementById('finalScore').style.display = 'block';
   document.getElementById('resetBtn').style.display = 'block';
}




async function showTopPlayerName() {
    try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbzDT1ifMtyL7TJlHgG916tiOhfdPpgQ8iZd-t41OjO7JoY9YXv0oCHJpAVFZaETpF4l1A/exec");
        const data = await response.json();
        data.sort((a,b)=> b.score - a.score); // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù†Ø²ÙˆÙ„ÛŒ
        const topPlayer = data[0]?.name || "Ù†Ø§Ø´Ù†Ø§Ø³";

        const div = document.getElementById("topPlayerName");
        div.innerHTML = `
            <div class="glowText">Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†</div>
            <div class="glowText">ğŸ† ${topPlayer} ğŸ†</div>
        `;
        div.style.display = "block";

        // Ø§Ú¯Ø± Ø¨Ø®ÙˆØ§Ù‡ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ Ù…Ø®ÙÛŒ Ø´ÙˆØ¯
        // setTimeout(()=>{ div.style.display = "none"; }, 5000);
    } catch(err) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ù†ÙØ± Ø§ÙˆÙ„:", err);
    }
}




function updateBallLabel(ball) {
    const rect = canvas.getBoundingClientRect();
    // Ù†Ù…Ø§ÛŒØ´ Ú©Ù†Ø§Ø± ØªÙˆÙ¾ Ø³Ù…Øª Ú†Ù¾ ØªÙˆÙ¾
    ballLabel.style.left = (rect.left + ball.x - 25) + "px"; // -25 Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø³Ù…Øª Ú†Ù¾
    ballLabel.style.top  = (rect.top + ball.y) + "px";

    // Ù…ØªÙ† Ø¹Ø¯Ø¯ Ú©Ù†Ø§Ø± ØªÙˆÙ¾: ÙÙ‚Ø· Ø¹Ø¯Ø¯ ØµØ­ÛŒØ­ (Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø± Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯)
    ballLabel.innerText = Math.floor((canvas.height - ball.y)/canvas.height*100);
    
    // Ù†Ù…Ø§ÛŒØ´ ÙÙ‚Ø· ÙˆÙ‚ØªÛŒ ØªÙˆÙ¾ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø±Ú©Øª Ø§Ø³Øª
    ballLabel.style.display = (isMoving || hasThrown) ? 'block' : 'none';
  if (ball.y <= 0) {
    soundradshodan100();
  }
}


// Ø¢Ù¾Ø¯ÛŒØª ÙÛŒØ²ÛŒÚ© / Ø¹Ù…Ø± Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒ Ø´Ù†Ø§ÙˆØ±
function updateFloats(){
    for(let i = floats.length - 1; i >= 0; i--){
        const f = floats[i];
        f.age++;
        f.y += f.vy;
        f.vy *= 0.99; // Ø¢Ø±Ø§Ù… Ø¢Ø±Ø§Ù… Ø³Ø±Ø¹Øª Ú©Ø§Ù‡Ø´ ÛŒØ§Ø¨Ø¯ (Ø·Ø¨ÛŒØ¹ÛŒâ€ŒØªØ±)
        const t = f.age / f.duration;
        f.opacity = Math.max(0, 1 - t);
        f.scale = 1 + 0.7 * t; // ØªØ§ 60% Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø´ÙˆØ¯
        if(f.age >= f.duration) floats.splice(i, 1);
    }
}




function checkInternetAtStart() {
    if (!navigator.onLine) {
        // Ù†Ù…Ø§ÛŒØ´ Ù‡Ø´Ø¯Ø§Ø±
        const warning = document.getElementById("internetWarning");
        warning.style.display = "block";

        // Ø¨Ø³ØªÙ† Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø§ Ø¯Ú©Ù…Ù‡
        const btn = document.getElementById("internetOkBtn");
        btn.onclick = () => { warning.style.display = "none"; };

        return false;
    }
    return true;
}

// ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù‡Ù†Ú¯Ø§Ù… Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
checkInternetAtStart();


function sendScore() {
    // Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§ Ø¯Ùˆ Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø±
    let finalScore = parseFloat(totalScore).toFixed(2);

    // Ù†Ù…Ø§ÛŒØ´ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ
    const scoreDiv = document.getElementById('finalScore');
    if(scoreDiv) {
        scoreDiv.innerHTML = `Your Score: ${finalScore}<br>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ØªØ¨Ù‡...`;
    }

    // Ø§Ø±Ø³Ø§Ù„ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡ Google Sheets Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø±ØªØ¨Ù‡
    fetch("https://script.google.com/macros/s/AKfycbzDT1ifMtyL7TJlHgG916tiOhfdPpgQ8iZd-t41OjO7JoY9YXv0oCHJpAVFZaETpF4l1A/exec", {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'name=' + encodeURIComponent(playerName) + '&score=' + encodeURIComponent(finalScore)
    })
    .then(res => res.json())  // JSON Ø¨Ø§ Ø±ØªØ¨Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    .then(data => {
        if(scoreDiv) {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±ØªØ¨Ù‡ Ø¯Ù‚ÛŒÙ‚ Ø²ÛŒØ± Ø§Ù…ØªÛŒØ§Ø²
            scoreDiv.innerHTML = `Your Score : ${finalScore}<br><br>Your Rank: ${data.rank} `;
        }
    })
    .catch(err => {
        console.error(err);
        if(scoreDiv) {
            scoreDiv.innerHTML = `Your Score : ${finalScore}<br>Ø±ØªØ¨Ù‡ Ø´Ù…Ø§ Ù‚Ø§Ø¨Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù†ÛŒØ³Øª ğŸ˜”`;
        }
    });
}











// === Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø®ÙˆØ¯Øª ===
const firebaseConfig = {
  apiKey: "AIzaSyAaTtsKvA5sbdJcMYOiwWlBOnX1T8FWmYw",
  authDomain: "partaab-26f3c.firebaseapp.com",
  databaseURL: "https://partaab-26f3c-default-rtdb.firebaseio.com",
  projectId: "partaab-26f3c",
  storageBucket: "partaab-26f3c.firebasestorage.app",
  messagingSenderId: "740437083261",
  appId: "1:740437083261:web:7a9a1d8dfe1926b1731d14"
};

// initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const chatRef = db.ref('gameChat');

// Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
chatRef.on('child_added', (snapshot) => {
  const data = snapshot.val();
  const msgDiv = document.createElement('div');
  msgDiv.textContent = `${data.name}: ${data.text}`;
  document.getElementById('chatMessages').appendChild(msgDiv);
  // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
  const chatBox = document.getElementById('chatMessages');
  chatBox.scrollTop = chatBox.scrollHeight;
});

// Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…
document.getElementById('chatSend').addEventListener('click', () => {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if(!text) return;
  chatRef.push({
    name: playerName, // Ø§Ø² Ù‚Ø¨Ù„ Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ø¯Ø§Ø±ÛŒØ¯
    text: text,
    timestamp: Date.now()
  });
  input.value = '';
});


document.getElementById('resetBtn').addEventListener('click', ()=>{

    // Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø§ÙˆÙ„ØŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù†
    totalScore = 0;
    turn = 0;
    turnScores = [];
    ball.scored = false;
    hasThrown = false;
    floats = [];
     resetBall();
    document.getElementById('score').innerText = '';
    document.getElementById('turns').innerText = 'Ù†ÙˆØ¨Øª: 0/' + maxTurns;
    document.getElementById('finalScore').style.display = 'none';
    document.getElementById('resetBtn').style.display = 'none';
    document.getElementById('totalScoreDisplay').innerText = 'Total Score : 0';
    document.getElementById('totalScoreDisplay').style.display = 'block';

  setTimeout(() => {
                // Ø¢Ø¯Ø±Ø³ ÙØ§ÛŒÙ„ HTML Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ… Ø¯Ø± GitHub (raw)
                const stageOneURL = "https://mohsenforghani.github.io/Partaab/";

                // Ù‡Ø¯Ø§ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ… Ø¯Ø± Ù‡Ù…Ø§Ù† ØªØ¨
                window.location.href = stageOneURL;
            }, 1500); // Ú©Ù…ÛŒ ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ

});


// Ø¯Ú©Ù…Ù‡ Ú©ÙˆÚ†Ú© Ù‡Ù…ÛŒØ´Ù‡ ÙØ¹Ø§Ù„
document.getElementById('resetBtnSmall').addEventListener('click', ()=> {
   // Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø§ÙˆÙ„ØŒ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù†
    totalScore = 0;
    turn = 0;
    turnScores = [];
    ball.scored = false;
    hasThrown = false;
    floats = [];
    resetBall();
    document.getElementById('score').innerText = '';
    document.getElementById('turns').innerText = 'Turn : 0/' + maxTurns;
    document.getElementById('finalScore').style.display = 'none';
    document.getElementById('resetBtn').style.display = 'none';
    document.getElementById('totalScoreDisplay').innerText = 'Total Score : 0';
    document.getElementById('totalScoreDisplay').style.display = 'block';

  setTimeout(() => {
                // Ø¢Ø¯Ø±Ø³ ÙØ§ÛŒÙ„ HTML Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ… Ø¯Ø± GitHub (raw)
                const stageOneURL = "https://mohsenforghani.github.io/partaab/index.html";

                // Ù‡Ø¯Ø§ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ… Ø¯Ø± Ù‡Ù…Ø§Ù† ØªØ¨
                window.location.href = stageOneURL;
            }, 1500); // Ú©Ù…ÛŒ ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ
});


document.getElementById('nameDisplay').innerText='Player : '+playerName;
let floats = [];



// ØªÙˆÙ„ÛŒØ¯ ÛŒÚ© Ø§Ù…ØªÛŒØ§Ø² Ø´Ù†Ø§ÙˆØ± Ø¬Ø¯ÛŒØ¯
function spawnFloat(text, x, y) {
    // x,y Ø¨Ù‡ Ù…Ø®ØªØµØ§Øª canvas Ø§Ø´Ø§Ø±Ù‡ Ø¯Ø§Ø±Ù†Ø¯ (Ù…Ø«Ù„ ball.x, ball.y)
    floats.push({
        text: text,
        x: x,
        y: y,
        vy: -0.8,        // Ø³Ø±Ø¹Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ù„Ø§ Ø±ÙØªÙ† (Ù…Ù†ÙÛŒ = Ø¨Ø§Ù„Ø§)
        age: 0,
        duration: 300,    // ØªØ¹Ø¯Ø§Ø¯ ÙØ±ÛŒÙ…â€ŒÙ‡Ø§ (Ù…Ø«Ù„Ø§Ù‹ 90 ~ 1.5s @60fps)
        opacity: 1,
        scale: 1,
        baseSize: Math.max(16, Math.floor(canvas.width / 40))
    });
}



// Ø±Ø³Ù… Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒ Ø´Ù†Ø§ÙˆØ± Ø±ÙˆÛŒ Ú©Ø§Ù†ÙˆØ§Ø³
// Ø§Ø² Ø¢Ø±Ø§ÛŒÙ‡ Ù…ÙˆØ¬ÙˆØ¯ 'floats' Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… (ØªÙˆ Ú©Ø¯Øª Ù‚Ø¨Ù„Ø§Ù‹ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡)
 // let floats = [];  // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ù‡Ø³Øª Ú©Ù‡ Ø¹Ø§Ù„ÛŒÙ‡ØŒ Ø§Ú¯Ø± Ù†Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†

// ØªÙˆÙ„ÛŒØ¯ ÛŒÚ© Ø§Ù…ØªÛŒØ§Ø² Ø´Ù†Ø§ÙˆØ± Ø¬Ø¯ÛŒØ¯
function spawnFloat(text, x, y){
    floats.push({
        text: text,
        x: x,
        y: y,
        vy: -0.6,        // Ø³Ø±Ø¹Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ù„Ø§ Ø±ÙØªÙ†
        age: 0,
        duration: 90,    // ØªØ¹Ø¯Ø§Ø¯ ÙØ±ÛŒÙ…â€ŒÙ‡Ø§ ØªØ§ Ú©Ø§Ù…Ù„ Ù…Ø­Ùˆ Ø´ÙˆØ¯ (~1.5s @60fps)
        opacity: 1,
        scale: 1,
        baseSize: Math.max(16, Math.floor(canvas.width/40))
    });
}

// Ø¢Ù¾Ø¯ÛŒØª ÙÛŒØ²ÛŒÚ© / Ø¹Ù…Ø± Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒ Ø´Ù†Ø§ÙˆØ±
function updateFloats(){
    // Ø¨Ø§ÛŒØ¯ Ù‡Ø± ÙØ±ÛŒÙ… ØµØ¯Ø§ Ø²Ø¯Ù‡ Ø´ÙˆØ¯ (Ø¯Ø± update())
    for (let i = floats.length - 1; i >= 0; i--) {
        const f = floats[i];
        f.age++;
        // Ø­Ø±Ú©Øª Ø¨Ø§Ù„Ø§ Ø±ÙØªÙ† Ø¨Ø§ Ú©Ù…ÛŒ Ø¢Ø±Ø§Ù… Ø´Ø¯Ù† (Ø·Ø¨ÛŒØ¹ÛŒâ€ŒØªØ±)
        f.y += f.vy;
        f.vy *= 0.985;

        // Ù†Ø³Ø¨Øª Ù¾ÛŒØ´Ø±ÙØª Ø§Ø² 0 ØªØ§ 1
        const t = Math.min(1, f.age / f.duration);

        // Ø´ÙØ§ÙÛŒØª Ø§Ø² 1 -> 0
        f.opacity = 1 - t;

        // Ø¨Ø²Ø±Ú¯ Ø´Ø¯Ù† Ø¢Ø±Ø§Ù…: Ø§Ø² scale=1 ØªØ§ 1.6 (Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø±Ùˆ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒ)
        f.scale = 1 + 0.6 * t;

        // Ø§Ú¯Ø± Ú©Ø§Ù…Ù„ Ø¹Ù…Ø±Ø´ Ú¯Ø°Ø´Øª Ø­Ø°Ù Ú©Ù†
        if (f.age >= f.duration) {
            floats.splice(i, 1);
        }
    }
}


// Ø±Ø³Ù… Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒ Ø´Ù†Ø§ÙˆØ± Ø±ÙˆÛŒ Ú©Ø§Ù†ÙˆØ§Ø³
function drawFloats(){
    if (!floats.length) return;
    ctx.save();

    for (const f of floats) {
        ctx.globalAlpha = f.opacity;
        const size = Math.floor(f.baseSize * f.scale);
        ctx.font = `bold ${size}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        // Ø³Ø§ÛŒÙ‡/Ú¯Ù„Ùˆ Ø¨Ø±Ø§ÛŒ Ø¬Ø°Ø§Ø¨ÛŒØª
        ctx.shadowColor = 'rgba(255,165,0,0.85)';
        ctx.shadowBlur = 12;

        // Ø±Ù†Ú¯ Ù…ØªÙ† (Ù†Ø§Ø±Ù†Ø¬ÛŒ)
        ctx.fillStyle = 'rgba(255,165,0,1)';
        ctx.fillText(f.text, f.x, f.y);

        // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø³Ø§ÛŒÙ‡
        ctx.shadowBlur = 0;
    }

    ctx.restore();
    ctx.globalAlpha = 1;
}




// Game loop
function gameLoop(){
    update();
    updateBallLabel(ball)
    draw();
    requestAnimationFrame(gameLoop);
    startGame()
}
if(checkInternetAtStart()){


const downloadBtn = document.getElementById("downloadBtn");

// Ú†Ú© Ú©Ø±Ø¯Ù† Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
if(localStorage.getItem("downloaded")) {
    downloadBtn.style.display = "none";
} else {
    downloadBtn.style.display = "block";
}

downloadBtn.addEventListener("click", async () => {
    // Ø§ÛŒØ¬Ø§Ø¯ ZIP Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„ ØµÙØ­Ù‡ HTML
    const zip = new JSZip();
    zip.file("PartaabGame.html", document.documentElement.outerHTML);

    const content = await zip.generateAsync({type:"blob"});

    // Ø§ÛŒØ¬Ø§Ø¯ Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ú©Ù„ÛŒÚ© Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©
    const a = document.createElement("a");
    a.href = URL.createObjectURL(content);
    a.download = "PartaabGame.zip";
    document.body.appendChild(a);
    a.click();
    a.remove();

    // Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡
    localStorage.setItem("downloaded", "true");
    downloadBtn.style.display = "none";
});



showTopPlayerName(); 
document.getElementById('totalScoreDisplay').style.display = 'block';
document.getElementById('totalScoreDisplay').innerText = 'Total Score : ' + totalScore.toFixed(2);
    gameLoop(); // Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ø²ÛŒ
} else {
document.getElementById('totalScoreDisplay').style.display = 'block';
document.getElementById('totalScoreDisplay').innerText = 'Total Score : ' + totalScore.toFixed(2);
    gameLoop(); // Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ø²ÛŒ
}




</script>
</body>
</html>





